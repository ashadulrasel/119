<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>íÜúùî∏ùï§ùïôùïíùïïùï¶ùïù ‚Ñùùïíùï§ùïñùïùíÜú</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Premium glassmorphic card with Telegram button above logo and periodic toast." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent-1: #00eaff;
      --accent-2: #7cffc4;
      --accent-3: #3be9ff;
      --text: #ffffff;
      --toast-offset: clamp(56px, 10svh, 120px);
      --card-radius: 32px;
      --elev: 0 10px 50px #0006;
      --easing: cubic-bezier(.2,.8,.2,1);
    }

    /* Typed custom props for smoother animation */
    @property --float { syntax: "<length>"; inherits: false; initial-value: 0px; }
    @property --rx    { syntax: "<angle>";  inherits: false; initial-value: 0deg; }
    @property --ry    { syntax: "<angle>";  inherits: false; initial-value: 0deg; }

    * { box-sizing: border-box; }
    html { -webkit-text-size-adjust: 100%; text-size-adjust: 100%; }
    body {
      margin: 0;
      min-height: 100svh;
      font-family: 'Hind Siliguri', system-ui, -apple-system, 'Segoe UI', Arial, sans-serif;
      color: var(--text);
      display: grid;
      place-items: center;
      background: radial-gradient(110% 90% at 10% 10%, #1b2b39 0%, #0f2027 35%, #0e1820 100%);
      overflow: hidden;
      position: relative;
      isolation: isolate;
    }

    /* Aurora backdrop */
    body::before{
      content:"";
      position: absolute; inset: -20%;
      background:
        radial-gradient(60% 80% at 10% 20%, #00eaff26 0%, transparent 60%),
        radial-gradient(60% 80% at 90% 80%, #7cffc420 0%, transparent 70%),
        radial-gradient(60% 60% at 30% 90%, #3be9ff1f 0%, transparent 70%);
      filter: blur(40px) saturate(120%);
      z-index: -2;
      animation: aurora 16s ease-in-out infinite alternate;
    }
    @keyframes aurora { 0% { transform: translateY(-2%) scale(1); opacity:.9; } 100%{ transform: translateY(2%) scale(1.03); opacity:1; } }
    @media (prefers-reduced-motion: reduce){ body::before{ animation:none; } }

    .container {
      width: 100%;
      min-height: inherit;
      display: grid;
      place-items: center;
      padding: max(12px, env(safe-area-inset-top)) max(12px, env(safe-area-inset-right)) max(12px, env(safe-area-inset-bottom)) max(12px, env(safe-area-inset-left));
      perspective: 1200px; /* for 3D tilt */
    }

    /* Logo card with built-in grid */
    .logo-area {
      display: grid;
      grid-template-areas:
        "btn btn"
        "avatar name";
      grid-template-columns: auto 1fr;
      align-items: center;
      column-gap: clamp(12px, 3.2vw, 28px);
      row-gap: clamp(12px, 3vw, 20px);

      background: rgba(255,255,255,0.08);
      padding: clamp(16px, 3.8vw, 40px) clamp(16px, 4vw, 48px);
      border-radius: var(--card-radius);
      box-shadow: var(--elev), 0 1.5px 0 #ffffff22 inset;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      max-width: min(92vw, 920px);
      width: 100%;
      overflow: hidden;
      transform-style: preserve-3d;
      transform: rotateX(var(--rx)) rotateY(var(--ry));
      transition: box-shadow .3s var(--easing), transform .3s var(--easing);
      position: relative;
    }
    .logo-area::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(120deg, transparent 0%, #ffffff0f 40%, transparent 60%);
      transform: translateX(-120%); animation: sheen 6s ease-in-out infinite; pointer-events:none;
    }
    @keyframes sheen { 0%, 70% { transform: translateX(-120%); } 100% { transform: translateX(120%); } }

    /* Telegram button inside card, above name */
    .telegram-btn {
      grid-area: btn;
      justify-self: center;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: clamp(8px, 2vw, 12px);
      padding: clamp(10px, 2.6vw, 14px) clamp(16px, 3.6vw, 24px);
      font-size: clamp(13px, 2.8vw, 16px);
      font-weight: 800;
      color: #fff;
      text-decoration: none;
      border: none;
      border-radius: 999px;
      background: linear-gradient(90deg, #0088cc 0%, #00eaff 100%);
      box-shadow: 0 12px 34px #00b3ff55, 0 1px 0 #ffffff88 inset;
      white-space: nowrap;
      max-width: min(92vw, 520px);
      -webkit-tap-highlight-color: transparent;
      position: relative;
      overflow: hidden;
      will-change: transform;
      /* Unified transform: magnetic + float via custom prop */
      transform: translate(var(--mx, 0px), calc(var(--my, 0px) + var(--float))) scale(1);
      animation: tgPop .7s var(--easing) both, tgFloat 4.2s ease-in-out 1.2s infinite alternate;
    }
    .telegram-btn:focus-visible {
      outline: 3px solid #7cffc4; outline-offset: 3px;
      box-shadow: 0 0 0 4px #00eaff44, 0 14px 40px #00eaff88;
    }
    .telegram-btn::after {
      content: ""; position: absolute; inset: 0;
      background: linear-gradient(120deg, transparent 0%, #ffffff2a 45%, transparent 60%);
      transform: translateX(-120%); pointer-events: none;
      animation: tgSheen 6s ease-in-out 1.6s infinite;
    }
    .telegram-icon {
      width: clamp(18px, 2.8vw, 24px);
      height: clamp(18px, 2.8vw, 24px);
      fill: #fff;
      filter: drop-shadow(0 0 6px #00eaffcc);
      flex: 0 0 auto;
    }
    @keyframes tgPop  { from { opacity: 0; transform: translateY(-10px) scale(.96);} to { opacity:1; transform: translateY(0) scale(1);} }
    @keyframes tgFloat{ 0% { --float: 0px; } 100% { --float: -6px; } }
    @keyframes tgSheen{ 0%,70%{ transform: translateX(-120%);} 100%{ transform: translateX(120%);} }

    /* Avatar with pulsing ring */
    .logo-avatar {
      grid-area: avatar;
      position: relative;
      width: clamp(64px, 15vw, 120px);
      aspect-ratio: 1;
      display: grid; place-items: center;
      transform: translateZ(12px);
    }
    .logo-avatar::before,
    .logo-avatar::after{
      content:""; position:absolute; inset:-6px;
      border-radius: 50%;
      pointer-events: none;
    }
    /* Outer glow ring (soft) */
    .logo-avatar::before{
      background: radial-gradient(60% 60% at 50% 50%, #00eaff55, transparent 70%);
      filter: blur(14px);
      animation: ringPulse 3.4s ease-in-out infinite alternate;
    }
    /* Inner rotating gradient ring */
    .logo-avatar::after{
      inset: -3px;
      background:
        conic-gradient(from 0deg, #00eaff, #7cffc4, #3be9ff, #00eaff);
      -webkit-mask: radial-gradient(circle, transparent calc(50% - 3px), #000 calc(50% - 1px));
              mask: radial-gradient(circle, transparent calc(50% - 3px), #000 calc(50% - 1px));
      filter: blur(.3px) saturate(1.1);
      animation: ringSpin 12s linear infinite;
      opacity:.9;
    }
    @keyframes ringPulse { from { transform: scale(1);   opacity:.65; } to { transform: scale(1.05); opacity: .9; } }
    @keyframes ringSpin  { to   { transform: rotate(360deg); } }

    .logo-img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #fff;
      box-shadow: 0 0 28px #ffffffaa, 0 0 22px #00eaff55;
      animation: logoGlow 2.6s ease-in-out infinite alternate;
    }
    @keyframes logoGlow { 0% { box-shadow: 0 0 18px #ffd70088, 0 0 10px #fff8;} 100%{ box-shadow: 0 0 42px #00eaffcc, 0 0 26px #fff;} }

    .logo-text {
      grid-area: name;
      font-size: clamp(1.25rem, 6vw, 2.7rem);
      line-height: 1.15;
      font-weight: 800;
      letter-spacing: 1.1px;
      background: linear-gradient(270deg, #ff00cc, #3333ff, #00ffcc, #ffcc00, #ff00cc);
      background-size: 1000% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradientMove 9s ease-in-out infinite;
      text-shadow: 0 2px 10px #0008, 0 0 20px #fff6, 0 0 40px #00f4;
      filter: drop-shadow(0 0 16px #fff6);
      overflow-wrap: anywhere;
      transform: translateZ(8px);
      margin: 0; /* ensure no extra gap */
    }
    @keyframes gradientMove { 0% { background-position: 0% 50%; } 50%{ background-position: 100% 50%; } 100%{ background-position: 0% 50%; } }

    /* Small screens: stack button ‚Üí avatar ‚Üí name */
    @media (max-width: 640px) {
      .logo-area{
        grid-template-areas:
          "btn"
          "avatar"
          "name";
        grid-template-columns: 1fr;
        justify-items: center;
        text-align: center;
      }
      .logo-text { text-align: center; }
    }

    /* Toast: positioned slightly up for all devices */
    .note-toast {
      --radius: 18px;
      --glass: rgba(255, 255, 255, 0.12);
      --border: rgba(255, 255, 255, 0.28);
      --shadow: 0 16px 60px #0007, 0 1px 0 #ffffff22 inset;

      position: fixed;
      left: 50%;
      bottom: calc(env(safe-area-inset-bottom, 0px) + var(--toast-offset));
      width: min(calc(100vw - 24px - env(safe-area-inset-left,0px) - env(safe-area-inset-right,0px)), 780px);
      padding: clamp(12px, 3.5vw, 16px) clamp(12px, 3.5vw, 16px) clamp(14px, 4vw, 20px);
      display: grid;
      grid-template-areas: "icon content actions";
      grid-template-columns: auto 1fr auto;
      align-items: start;
      gap: clamp(10px, 2.8vw, 14px);
      z-index: 9999;
      overflow: hidden;
      isolation: isolate;
      background: radial-gradient(120% 140% at 0% 100%, #ffffff1a 0%, #ffffff0d 50%, #ffffff08 100%), var(--glass);
      color: #fff;
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      --y: 120%; --scale: .98;
      transform: translate(-50%, var(--y)) scale(var(--scale)) translateZ(0.001px);
      transition: transform 540ms var(--easing), opacity 420ms ease;
      opacity: 0;
    }
    .note-toast.show { --y: 0%; --scale: 1; opacity: 1; }
    .note-toast::before { content: ""; position: absolute; left: 0; top: 0; bottom: 0; width: 5px;
      background: linear-gradient(180deg, var(--accent-1), var(--accent-2)); box-shadow: 0 0 26px #00eaff66; }
    .note-layers { position: absolute; inset: 0; pointer-events: none; }
    .note-aurora { position: absolute; inset: -20%;
      background: radial-gradient(40% 60% at 20% 100%, #00eaff22 0%, transparent 70%), radial-gradient(50% 50% at 80% 0%, #7cffc420 0%, transparent 70%);
      filter: blur(28px) saturate(120%); animation: toastAurora 12s ease-in-out infinite alternate; }
    @keyframes toastAurora { 0% { transform: translateY(0) scale(1); } 100%{ transform: translateY(-4%) scale(1.04); } }
    .note-glow { position: absolute; inset: -30% -30% auto -30%; height: 60%;
      background: radial-gradient(60% 100% at 50% 100%, #00eaff33, transparent 70%); filter: blur(20px); opacity: .7; }
    .note-noise { position: absolute; inset:0;
      background-image: linear-gradient(transparent 0%, rgba(255,255,255,.04) 50%, transparent 100%),
                       repeating-linear-gradient(90deg, rgba(255,255,255,.02) 0, rgba(255,255,255,.02) 2px, transparent 3px, transparent 6px);
      mix-blend-mode: overlay; opacity:.6; }
    .note-particles { position: absolute; inset: 0; overflow: hidden; }
    .note-particles i{ position:absolute; bottom:-8px; width:6px; height:6px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, transparent 60%); opacity:.8; filter: drop-shadow(0 0 6px #00eaffaa);
      animation: bubble 8s linear infinite; }
    .note-particles i:nth-child(1){ left:8%;  animation-duration:7s; }
    .note-particles i:nth-child(2){ left:22%; animation-duration:9s; animation-delay:.6s; }
    .note-particles i:nth-child(3){ left:35%; animation-duration:8.5s; animation-delay:1.2s; }
    .note-particles i:nth-child(4){ left:48%; animation-duration:7.6s; animation-delay:.2s; }
    .note-particles i:nth-child(5){ left:62%; animation-duration:9.6s; animation-delay:.9s; }
    .note-particles i:nth-child(6){ left:76%; animation-duration:8.2s; animation-delay:1.3s; }
    .note-particles i:nth-child(7){ left:89%; animation-duration:7.8s; animation-delay:.4s; }
    @keyframes bubble { 0%{ transform: translateY(0) translateX(0) scale(.9); opacity:0;} 10%{opacity:.8;} 100%{ transform: translateY(-160%) translateX(-10px) scale(1.2); opacity:0;} }

    .note-icon { grid-area: icon; width: clamp(36px, 8vw, 44px); height: clamp(36px, 8vw, 44px);
      display:grid; place-content:center; border-radius:12px;
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      box-shadow: 0 10px 26px #00eaff66, inset 0 1px 0 #ffffff66; color:#00232e; align-self:start; margin-left:2px; }
    .note-icon .emoji { font-size: clamp(18px, 4.2vw, 24px); filter: drop-shadow(0 0 6px #ffffffaa); }
    .note-content { grid-area: content; display:flex; flex-direction:column; gap:6px; min-width:0; }
    .note-title   { margin:0; font-size: clamp(15px, 3.5vw, 18px); font-weight:700; letter-spacing:.2px; text-shadow:0 1px 10px #0007; }
    .note-text    { margin:0; font-size: clamp(13px, 3.2vw, 16px); line-height:1.55; text-wrap: pretty; }
    .note-actions { grid-area: actions; display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .note-cta {
      appearance:none; border:none; cursor:pointer;
      padding: clamp(8px, 2.2vw, 10px) clamp(12px, 3vw, 14px);
      border-radius:12px; font-weight:800;
      color:#00232e; background: linear-gradient(135deg, #00ffc6, #3be9ff);
      box-shadow: 0 8px 26px #00eaff66, inset 0 1px 0 #ffffffaa;
      transition: transform .15s ease, box-shadow .25s ease, filter .2s ease;
      text-decoration:none; white-space:nowrap; font-size: clamp(12px, 2.8vw, 14px); position:relative; overflow:hidden;
    }
    .note-cta::after{ content:""; position:absolute; top:0; bottom:0; left:-40%; width:40%; transform: skewX(-24deg);
      background: linear-gradient(90deg, #ffffff55, transparent); opacity:0; pointer-events:none; transition: opacity .2s; }
    .note-cta:hover { transform: translateY(-1px); box-shadow: 0 12px 32px #00eaff99; }
    .note-cta:hover::after { animation: ctaShine 1.2s ease; opacity:1; }
    @keyframes ctaShine { from { left:-40%; } to { left:140%; } }
    .note-close, .note-optout {
      height: clamp(30px, 7vw, 36px);
      display:grid; place-content:center;
      border-radius:999px; background:#ffffff16; color:#fff;
      border:1px solid #ffffff22; box-shadow: inset 0 1px 0 #ffffff55; cursor:pointer;
      padding:0 clamp(10px, 2.6vw, 12px); font-weight:700;
      transition: background .2s ease, transform .15s ease; white-space:nowrap; font-size: clamp(11px, 2.6vw, 13px);
    }
    .note-close { width: clamp(30px, 7vw, 36px); padding:0; }
    .note-close:hover, .note-optout:hover { background:#ffffff24; transform: translateY(-1px); }
    .note-progress { position:absolute; left:0; right:0; bottom:0; height:3px; background:#ffffff1a; border-radius:0 0 var(--radius) var(--radius); overflow:hidden; }
    .note-progress-bar { width:0%; height:100%; background: linear-gradient(90deg, #00ffc6, #00eaff, #77faff); background-size:200% 100%; box-shadow:0 0 12px #00eaffaa; animation:none; }
    @keyframes noteProgress { from { width:0%; background-position:0% 50%; } to { width:100%; background-position:100% 50%; } }

    /* Tiny screens: stack toast actions */
    @media (max-width: 420px) {
      .note-toast {
        grid-template-areas:
          "icon content"
          "actions actions";
        grid-template-columns: auto 1fr;
        gap: 10px;
      }
      .note-progress { height: 2px; }
    }

    @media (prefers-reduced-motion: reduce){
      .telegram-btn, .logo-area, .logo-avatar::before, .logo-avatar::after, .logo-img, .logo-text,
      .note-toast, .note-aurora, .note-particles i { animation: none !important; transition: none !important; }
      .note-cta::after { display: none; }
      .note-progress-bar { animation: none !important; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Logo card with Telegram button above the name -->
    <div class="logo-area" id="card">
      <a href="https://t.me/AllFreePlatform" target="_blank" rel="noopener noreferrer" class="telegram-btn" id="tgBtn" aria-label="Join on Telegram">
        <svg class="telegram-icon" viewBox="0 0 240 240" aria-hidden="true" focusable="false">
          <circle cx="120" cy="120" r="120" fill="#0088cc"/>
          <path d="M180.7 70.6c2.2-9.1-7.1-16.6-15.2-12.7L44.7 120.2c-8.1 3.9-7.7 15.5.6 18.7l34.2 13.7 13.7 34.2c3.2 8.3 14.8 8.7 18.7.6l62.3-120.8z" fill="#fff"/>
          <path d="M180.7 70.6l-62.3 120.8c-3.9 8.1-15.5 7.7-18.7-.6l-13.7-34.2 94.7-85.9z" fill="#c8e6fa"/>
        </svg>
        Join Telegram
      </a>

      <div class="logo-avatar">
        <img class="logo-img" src="https://iili.io/F4fJTgI.jpg" alt="Ashadul Rasel logo" width="120" height="120" decoding="async" fetchpriority="high">
      </div>
      <h1 class="logo-text" translate="no">íÜúùî∏ùï§ùïôùïíùïïùï¶ùïù ‚Ñùùïíùï§ùïñùïùíÜú</h1>
    </div>
  </div>

  <!-- Toast -->
  <div id="note-toast" class="note-toast" role="status" aria-live="polite" aria-atomic="true" aria-label="App download notification">
    <div class="note-layers" aria-hidden="true">
      <div class="note-aurora"></div>
      <div class="note-glow"></div>
      <div class="note-noise"></div>
      <div class="note-particles"><i></i><i></i><i></i><i></i><i></i><i></i><i></i></div>
    </div>

    <div class="note-icon" aria-hidden="true"><span class="emoji">üì∫</span></div>

    <div class="note-content">
      <h3 class="note-title">Dear IPTV users,</h3>
      <p class="note-text">We have brought you a great app for enjoying buffering-free TV, the A.R Live Stream app. Download it now and enjoy.</p>
    </div>

    <div class="note-actions">
      <a id="note-cta" class="note-cta" href="https://t.me/AllFreePlatform/359" target="_blank" rel="noopener noreferrer">Download Now</a>
      <button id="note-optout" class="note-optout" type="button" title="Don't show again">Don't show</button>
      <button id="note-close" class="note-close" type="button" aria-label="Close note" title="Close">‚úï</button>
    </div>

    <div class="note-progress" aria-hidden="true"><div class="note-progress-bar"></div></div>
  </div>

  <script>
    // Card tilt + magnetic button (pointer devices)
    (function () {
      const card = document.getElementById('card');
      const btn  = document.getElementById('tgBtn');
      const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
      const canTilt = matchMedia('(pointer: fine) and (hover: hover)').matches && !prefersReduced;

      if (!canTilt) return;

      let raf = null;
      function onMove(e) {
        const r = card.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width;
        const y = (e.clientY - r.top)  / r.height;

        const ry = (x - 0.5) * 10;   // rotateY
        const rx = -(y - 0.5) * 8;   // rotateX
        // magnetic offset for button (smaller range)
        const mx = (x - 0.5) * 10;
        const my = (y - 0.5) * 8;

        if (raf) cancelAnimationFrame(raf);
        raf = requestAnimationFrame(() => {
          card.style.setProperty('--ry', ry.toFixed(2) + 'deg');
          card.style.setProperty('--rx', rx.toFixed(2) + 'deg');
          btn.style.setProperty('--mx', mx.toFixed(1) + 'px');
          btn.style.setProperty('--my', my.toFixed(1) + 'px');
        });
      }
      function onLeave() {
        if (raf) cancelAnimationFrame(raf);
        card.style.setProperty('--ry', '0deg');
        card.style.setProperty('--rx', '0deg');
        btn.style.setProperty('--mx', '0px');
        btn.style.setProperty('--my', '0px');
      }

      card.addEventListener('mousemove', onMove);
      card.addEventListener('mouseleave', onLeave);
      window.addEventListener('blur', onLeave);
    })();

    // Toast controller (interval show + pause/resume + swipe dismiss)
    (function () {
      const toast = document.getElementById('note-toast');
      const closeBtn = document.getElementById('note-close');
      const optoutBtn = document.getElementById('note-optout');
      const ctaBtn = document.getElementById('note-cta');
      const progressBar = toast.querySelector('.note-progress-bar');

      const STORAGE_KEY = 'ar_live_stream_toast_optout';
      const INTERVAL_MS = 10000, VISIBLE_MS = 4000, FIRST_DELAY = 900;
      let isShowing = false, hideTimer = null, intervalId = null;
      let remaining = VISIBLE_MS, startTime = 0;
      const isOptedOut = () => localStorage.getItem(STORAGE_KEY) === '1';

      function startProgress(duration) {
        progressBar.style.animation = 'none'; progressBar.style.width = '0%';
        void progressBar.offsetWidth;
        progressBar.style.animation = `noteProgress ${duration}ms linear forwards`;
      }
      function showToast() {
        if (isShowing || isOptedOut() || document.hidden) return;
        isShowing = true; remaining = VISIBLE_MS; startTime = performance.now();
        toast.classList.add('show'); startProgress(remaining);
        hideTimer = setTimeout(hideToast, remaining);
      }
      function hideToast() {
        toast.classList.remove('show'); isShowing = false;
        clearTimeout(hideTimer); hideTimer = null; progressBar.style.animation = 'none';
        toast.style.removeProperty('--y'); toast.style.removeProperty('--scale'); toast.style.removeProperty('opacity');
      }
      function pauseToast() {
        if (!isShowing) return;
        const elapsed = performance.now() - startTime;
        remaining = Math.max(0, remaining - elapsed); clearTimeout(hideTimer); hideTimer = null;
        progressBar.style.animationPlayState = 'paused';
      }
      function resumeToast() {
        if (!isShowing || remaining <= 0) return;
        startTime = performance.now();
        const containerWidth = toast.querySelector('.note-progress').clientWidth || 1;
        const currentWidth = progressBar.getBoundingClientRect().width;
        const pct = Math.min(100, Math.max(0, (currentWidth / containerWidth) * 100));
        progressBar.style.animation = 'none'; progressBar.style.width = pct + '%';
        void progressBar.offsetWidth;
        progressBar.style.animation = `noteProgress ${remaining}ms linear forwards`;
        progressBar.style.animationPlayState = 'running';
        hideTimer = setTimeout(hideToast, remaining);
      }

      toast.addEventListener('mouseenter', pauseToast);
      toast.addEventListener('mouseleave', resumeToast);
      toast.addEventListener('focusin', pauseToast);
      toast.addEventListener('focusout', resumeToast);

      let touchStartY = 0, dragging = false;
      toast.addEventListener('touchstart', (e) => { if (!isShowing) return; touchStartY = e.touches[0].clientY; dragging = true; pauseToast(); }, { passive: true });
      toast.addEventListener('touchmove', (e) => {
        if (!dragging) return;
        const dy = e.touches[0].clientY - touchStartY;
        const translateY = Math.max(0, dy);
        toast.style.setProperty('--y', translateY + 'px');
        toast.style.setProperty('--scale', '0.98');
        toast.style.opacity = String(Math.max(0.35, 1 - translateY / 300));
      }, { passive: true });
      toast.addEventListener('touchend', () => {
        if (!dragging) return; dragging = false;
        const yVar = toast.style.getPropertyValue('--y'); const translateY = yVar ? parseFloat(yVar) : 0;
        toast.style.removeProperty('--scale'); toast.style.removeProperty('opacity');
        if (translateY > 100) { toast.style.removeProperty('--y'); hideToast(); } else { toast.style.removeProperty('--y'); resumeToast(); }
      });

      closeBtn.addEventListener('click', hideToast);
      optoutBtn.addEventListener('click', () => { localStorage.setItem(STORAGE_KEY, '1'); hideToast(); clearInterval(intervalId); });

      ctaBtn.addEventListener('click', (e) => {
        const rect = ctaBtn.getBoundingClientRect(); const r = Math.max(rect.width, rect.height);
        const span = document.createElement('span'); span.className = 'ripple';
        span.style.width = span.style.height = r + 'px';
        span.style.left = (e.clientX - rect.left - r / 2) + 'px';
        span.style.top  = (e.clientY - rect.top  - r / 2) + 'px';
        ctaBtn.appendChild(span); setTimeout(() => span.remove(), 650);
      });

      window.addEventListener('keydown', (e) => { if (e.key === 'Escape' && isShowing) hideToast(); });
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) { clearInterval(intervalId); }
        else if (!isOptedOut()) { clearInterval(intervalId); intervalId = setInterval(showToast, INTERVAL_MS); }
      });

      if (!isOptedOut()) { setTimeout(showToast, FIRST_DELAY); intervalId = setInterval(showToast, INTERVAL_MS); }
      window.addEventListener('pagehide', () => { clearInterval(intervalId); clearTimeout(hideTimer); });
    })();
  </script>
</body>
</html>
